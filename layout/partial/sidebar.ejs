<div class="sidebar-section">
  <h3>About</h3>
  <p><%= config.description || 'Just a dumb journal.' %></p>
</div>
<% if (has_social_buttons()) { %>
<div class="sidebar-section social-buttons">
    <%- social_buttons() %>
</div>
<% } %>
<div class="sidebar-section">
  <h3>Recent Posts</h3>
  <ul>
    <% site.posts.sort('date', -1).limit(5).forEach(function(post) { %>
    <li>
      <a href="<%= url_for(post.path) %>"><%= post.title %></a>
      <% if (post.encrypted) { %>
      <%- partial('partial/lock') %>
      <% } %>
    </li>
    <% }) %>
  </ul>
</div>
<%
var sidebarCfg = theme.sidebar || {},
  rpCfg = sidebarCfg.recent_projects || {},
  rpEnabled = rpCfg.enabled !== false,
  rpLimit = rpCfg.limit || 5,
  recentProjects = (rpEnabled && typeof recent_projects === 'function') ? recent_projects(rpLimit) : [];
%>
<% if (rpEnabled && recentProjects.length) { %>
<div class="sidebar-section">
  <h3>Recent Projects</h3>
  <ul>
    <% recentProjects.forEach(function(project) { var href = project.path ? url_for(project.path): (project.project_url || '#'); %>
    <li>
      <a href="<%= href %>">
        <% if (project.password) { %>
        <%- partial('partial/lock') %>
        <% } %>
        <span><%= project.title %></span>
      </a>
    </li>
    <% }); %>
  </ul>
</div>
<% } %>
<% if (theme.sidebar?.palette_selector?.enabled) { %>
<%
  var palettes = palette_list ? palette_list() : [],
    defaultKey = (
        theme.sidebar?.palette_selector && theme.sidebar.palette_selector?.default
    ) ? theme.sidebar.palette_selector.default : 'abyssal-blue',
    hasDefault = palettes.some(function (p) { return p.key === defaultKey; });
  if (!hasDefault && palettes.length) {
    defaultKey = palettes[0].key;
  }
%>
<div class="sidebar-section">
  <h3>Palette</h3>
  <div class="palette-switcher">
    <select id="palette-select">
      <% palettes.forEach(function (p) { %>
      <option value="<%= p.key %>" <%= (defaultKey === p.key) ? 'selected' : '' %>>
        <%= p.name || p.key || p.file %>
      </option>
      <% }); %>
    </select>
  </div>
</div>
<% if (palettes.length) { %>
<script>
  (function() {
    var STORAGE_KEY = 'flux-palette',
      select = document.getElementById('palette-select');
    if (!select)
      return;

    // Determine which palette is currently active (from <html>)
    var html = document.documentElement,
      current = html.getAttribute('data-palette') || select.value;

    // Keep <select> in sync
    select.value = current;

    function apply(key) {
      if (!key)
        return;
      key = String(key).replace(/[^a-zA-Z0-9_-]/g, '');
      html.setAttribute('data-palette', key);
      try {
        localStorage.setItem(STORAGE_KEY, key);
      } catch (e) {
        // ignore
      }
    }

    // On change, just flip the attribute + persist
    select.addEventListener('change', function() {
      apply(this.value);
    });
  })();
</script>
<% } %>
<% } %>